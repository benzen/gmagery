import org.magery.Compiler
import org.magery.Runtime
import groovy.json.JsonBuilder

try{
  def templates = [:]
  templates = Compiler.compileTemplates("public/templates/app-title.html", templates)
  templates = Compiler.compileTemplates("public/templates/app-root.html", templates)
  templates = Compiler.compileTemplates("public/templates/app-button.html", templates)
  def state = [key: "value", title: "Sake", counter: 0]
  def str = Runtime.renderToString(templates, "app-root", state)
  println """
  <html>
    <head>
      ${new File("public/templates/app-root.html").text}
      ${new File("public/templates/app-button.html").text}
      ${new File("public/templates/app-title.html").text}
      <script src="/js/redux.js" type="text/javascript"></script>
      <script src="/js/magery-compiler.js" type="text/javascript"></script>
      <script src="/js/magery-runtime.js" type="text/javascript"></script>
    </head>
    <body>
      $str
      <script type="text/javascript">
        window.APP = {
          initialState: ${new JsonBuilder(state).toString()}
        };
      </script>
      <script src="/js/app.js" type="text/javascript"></script>

    </body>
  <html>
  """
} catch (Exception e) {
  println "ERROR $e"
}
